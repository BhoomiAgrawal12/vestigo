# File Organization Reference

## Directory Structure Overview

```
active_tracing_harness/                    [7.0 MB total, 23 files]
│
├── README.md                              # Main project documentation
├── ORGANIZATION.md                        # This file
│
├── Core Scripts (3 files)                 # Primary execution tools
│   ├── harness.py                         # 33 KB - Dual-engine orchestrator
│   ├── quick_trace.py                     # 9.6 KB - Lightweight tracer
│   └── analyze_trace.py                   # 3.4 KB - Crypto pattern detector
│
├── Specialized Tools (1 file)
│   └── trace_crypto_binary.py             # 3.3 KB - Crypto-focused tracer
│
├── docs/ (6 files)                        # Complete documentation suite
│   ├── START_HERE.md                      # Quick start guide
│   ├── HARNESS_README.md                  # Complete usage manual
│   ├── HARNESS_IMPLEMENTATION.md          # Technical architecture
│   ├── HARNESS_ARCHITECTURE.txt           # Visual diagrams
│   ├── HARNESS_COMPLETE.md                # Navigation guide
│   └── DELIVERY_SUMMARY.md                # Executive summary
│
├── tests/ (5 files)                       # Testing infrastructure
│   ├── demo_harness.py                    # Automated demo
│   ├── complete_test.py                   # Full test suite
│   ├── test_firmware.c                    # Test binary source
│   ├── simple_test                        # Compiled test (785 KB)
│   └── golden_input.bin                   # Test input data
│
├── tools/ (3 files)                       # Setup and utilities
│   ├── setup_harness.sh                   # Installation script
│   ├── harness_cheatsheet.sh              # Quick reference
│   └── requirements_harness.txt           # Python dependencies
│
├── output/                                # Generated outputs
│   ├── traces/                            # JSONL trace files
│   └── inputs/                            # Generated input buffers
│
└── examples/                              # Example usage scripts
```

## File Purposes

### Core Execution Files

**harness.py** (Primary tool)
- Implements dual-engine architecture (angr + Qiling)
- Automatic input generation via symbolic execution
- Instruction-level dynamic tracing
- CLI with 20+ configurable options
- Output: JSONL traces + generated inputs

**quick_trace.py** (Fast alternative)
- Lightweight tracing without symbolic execution
- Requires pre-existing input files
- Faster iteration for testing
- Same JSONL output format

**analyze_trace.py** (Post-processing)
- Detects cryptographic patterns in traces
- Sliding window heuristic analysis
- Identifies handshake/key exchange operations
- Generates summary reports

**trace_crypto_binary.py** (Specialized)
- Optimized for tracing crypto binaries
- Extended timeouts and instruction limits
- Crypto-specific analysis hooks

### Documentation Files

**START_HERE.md** → Begin here for setup and basic concepts  
**HARNESS_README.md** → Complete manual with all options and examples  
**HARNESS_IMPLEMENTATION.md** → Technical architecture details  
**HARNESS_ARCHITECTURE.txt** → ASCII diagrams and data flow  
**HARNESS_COMPLETE.md** → Project overview and file navigation  
**DELIVERY_SUMMARY.md** → Executive summary of capabilities  

### Testing Files

**demo_harness.py**
- Automated end-to-end demonstration
- Compiles test binary
- Runs full workflow
- Validates output

**complete_test.py**
- Comprehensive test suite
- Tests both engines independently
- Validates trace generation
- Reports statistics

**test_firmware.c**
- Source code for test binary
- Simulates firmware recv() behavior
- Validates input protocols

**simple_test**
- Compiled static ELF binary (x86_64)
- Used for testing and demos

**golden_input.bin**
- Valid input generated by symbolic execution
- Used for testing quick_trace.py

### Tool Files

**setup_harness.sh**
- Automated installation script
- Creates virtual environment
- Installs all dependencies
- Downloads Qiling rootfs

**harness_cheatsheet.sh**
- Quick reference commands
- Common usage patterns
- Troubleshooting snippets

**requirements_harness.txt**
- Python package dependencies
- Version specifications
- Install via: `pip install -r requirements_harness.txt`

## Workflow Paths

### Path 1: First-Time Setup
```
1. Read: docs/START_HERE.md
2. Run: tools/setup_harness.sh
3. Test: python3 tests/demo_harness.py
4. Trace: python3 harness.py /path/to/binary
```

### Path 2: Quick Testing (Known Input)
```
1. python3 quick_trace.py binary --input-file input.bin
2. python3 analyze_trace.py output/traces/trace.jsonl
```

### Path 3: Full Analysis (Unknown Input)
```
1. python3 harness.py binary --verbose
2. python3 analyze_trace.py output/traces/*_trace.jsonl
3. Review: output/traces/*_report.txt
```

### Path 4: Crypto Binary Focus
```
1. python3 trace_crypto_binary.py crypto_binary
2. python3 analyze_trace.py output/traces/crypto_trace.jsonl
3. Check for handshake/key_exchange phases
```

## Integration Points

### Input Sources
- Firmware samples: `../../firmware_samples/`
- Test binaries: `../../test_dataset_binaries/`
- Crypto binaries: `../../dataset_binaries/`

### Output Consumers
- ML training: `../../ml/` (LSTM models)
- Analysis scripts: `../../scripts/`
- GNN pipeline: `../../gnn_output/`

### Shared Resources
- Qiling environment: `../qiling_env/` (Python virtual environment)
- Rootfs: `../rootfs/x8664_linux/` (System emulation files)

## Maintenance Notes

### Adding New Features
1. Update core scripts (harness.py, quick_trace.py, analyze_trace.py)
2. Add tests to `tests/complete_test.py`
3. Document in `docs/HARNESS_README.md`
4. Update this ORGANIZATION.md

### Extending Documentation
- User guides → `docs/HARNESS_README.md`
- Technical details → `docs/HARNESS_IMPLEMENTATION.md`
- Architecture changes → `docs/HARNESS_ARCHITECTURE.txt`

### Version Control
- Core scripts are executable: `chmod +x harness.py quick_trace.py`
- Test binaries may need recompilation: `gcc test_firmware.c -o simple_test`
- Virtual environment is NOT version controlled (recreate via setup_harness.sh)

## Quick Commands

```bash
# Run full demo
cd tests/ && python3 demo_harness.py

# Trace with verbose output
python3 harness.py /path/to/binary --verbose

# Quick trace existing input
python3 quick_trace.py binary --input-file input.bin

# Analyze crypto patterns
python3 analyze_trace.py output/traces/trace.jsonl

# Run all tests
cd tests/ && python3 complete_test.py

# Get help
python3 harness.py --help
python3 quick_trace.py --help
python3 analyze_trace.py --help
```

## Size Breakdown

- **Core scripts**: ~50 KB (harness.py, quick_trace.py, analyze_trace.py)
- **Documentation**: ~70 KB (6 markdown/txt files)
- **Test binary**: ~785 KB (simple_test compiled ELF)
- **Test scripts**: ~25 KB (demo_harness.py, complete_test.py)
- **Tools**: ~15 KB (setup scripts, requirements)
- **Trace outputs**: Variable (typically 1-10 MB per trace)

**Total project size**: ~7.0 MB

---

This organization was created on Dec 7, 2025 to consolidate all "handshake and key exchange" tracing infrastructure into a single, well-structured location within the vestigo-data project.
